
@{
    ViewData["Title"] = "Show1";
}

<h1>Show1</h1>


<script src="~/echarts.min.js"></script>
<body>
    <!--  为 ECharts 准备一个具备大小（宽高）的 DOM 饼形图 -->
    <div id="first" style="width: 600px;height:400px;"></div>
</body>
//饼图模板
var dom = document.getElementById("first");
var myChart = echarts.init(dom);
var app = {};
option = null;
option = {
        title : {
            text: '用户位置记录',
            subtext: '',
            x:'center'
        },
        tooltip : {
            trigger: 'item',
            formatter: "{a}
<br />{b} : {c} ({d}%)"
        },
        legend: {
            orient : 'vertical',
            x : 'left',
            data:[]
        },
        toolbox: {
            show : true,
            feature : {
                mark : {show: true},
                dataView : {show: true, readOnly: false},
                magicType : {
                    show: true,
                    type: ['pie', 'funnel'],
                    option: {
                        funnel: {
                            x: '25%',
                            width: '50%',
                            funnelAlign: 'left',
                            max: 1548
                        }
                    }
                },
                restore : {show: true},
                saveAsImage : {show: true}
            }
        },
        calculable : true,
        series : [
            {
                name:'',
                type:'pie',
                radius : '55%',
                center: ['50%', '60%'],
                data:[]
            }
        ]
    };
;
if (option && typeof option === "object") {
    myChart.setOption(option, true);
}
//饼图动态赋值
var year = $("#year-search").val();
    var mouth = $("#mouth-search").val();
    $.ajax({
           type: "get",
           url: http://localhost:51166/api/Panel/GetShow",
           data : {"year":year,"mouth":mouth},
           cache : false,    //禁用缓存
           dataType: "json",
           success: function(result) {
                var names=[];//定义两个数组
                  var nums=[];
                  $.each(result,function(key,values){
                      names.push(values.province_name);
                      var obj = new Object();
                      obj.name = values.province_name;
                      obj.value = values.count;
                      nums.push(obj);
                   });
                myChart.setOption({ //加载数据图表
                          legend: {
                                data: names
                               },
                        series: {
                                // 根据名字对应到相应的系列
                                name: ['数量'],
                                data: nums
                                }
           });
           },
           error: function(XMLHttpRequest, textStatus, errorThrown) {
               alert("查询失败");
           }
    });
